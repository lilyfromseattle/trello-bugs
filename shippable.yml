# Language setting
language: node_js

# Version number
node_js:
  - 0.10.25

# The path for Xunit to output test reports
env:
    global:
      - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
      - XUNIT_FILE=shippable/testresults/result.xml
      - APP_NAME=trello-bug-counter
      - secure: THtq5USX3f3r6obppqmVTTQ4whAZh0tLdGhj5VTvDS4OYfLZsYbd7U1ErMcpbNS90OAqILPNWQpPQpx9L3MQ3yhsYKRdupJedJDZiTMTNnzWwIqB2doR8wJ+duOfUPHdaXDtgi29TNDjydMVe0T70PJ95DcuNp+9g0n3AFkgIEk=
before_install:
  - npm install
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

script:
  - npm run mocha-test
  - heroku keys:add
  - git push -f git@heroku.com:$APP_NAME.git master
  - npm run casper-test
# Running the tests with grunt

# Tell istanbul to generate a coverage report
after_script:
  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
