# Language setting
language: node_js

# Version number
node_js:
  - 0.10.25

# The path for Xunit to output test reports
env:
    global:
      - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage
      - XUNIT_FILE=shippable/testresults/result.xml
      - APP_NAME=trello-bug-counter
      - secure: fp8WdXzc30c6nj1WesQmndYty+RWClPdwymuLT+HroMeTl5ccpfEa6FZyQN7zqZsm+TpZOwCWVbiqQoEvUMjMCVuz0XomEKZL+41J91JZ5SonrFikdoc9C/BgdKJsAurCuQi1QHN9h0bihfetAqQaDC/nMEhYYUfOHb61/XtZSMXQv9Iqs9o8B7YYgqz3BNS3HpYBiNcUWVNm9P0Er9xdm3jhiTJqusOrHFtn8z682Ld27PMMLlL4aEh0cfLWtGs4bIl5SpJHaKz2KfQ8gWnxcHgB4whMAJXSKTEmmBOw300py8lXQmL/QE024idtETVgTT8ur9br8/igWZa0PPp5g==
before_install:
  - npm install
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

script:
  - npm run mocha-test
  - git push -f git@heroku.com:$APP_NAME.git master
  - npm run casper-test
# Running the tests with grunt

# Tell istanbul to generate a coverage report
after_script:
  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
